#include <stdio.h>
#include <elf.h>
#include <sys/stat.h>
#include <fcntl.h>
#include <sys/types.h>
#include <sys/mman.h>

void print_elf_header(Elf32_Ehdr *ehdr)
{
	char *type;
	char *data_encoding;
	char *architecture;
	char *OS_name;
	char *version;


	switch (ehdr->e_ident[EI_CLASS])
	{
		case ELFCLASSNONE:
			architecture = "invalide";
			break;
		case ELFCLASS32:
			architecture = "32 bits";
			break;
		case ELFCLASS64:
			architecture = "64 bits";
			break;
	}

	switch (ehdr->e_ident[EI_DATA])
	{
		case ELFDATANONE:
			data_encoding = "inconnue";
			break;
		case ELFDATA2LSB:
			data_encoding = "little-endian";
			break;
		case ELFDATA2MSB:
			data_encoding = "big-endian";
			break;
	}

	switch (ehdr->e_ident[EI_VERSION])
	{
		case EV_NONE:
			version = "invalide";
			break;
		case EV_CURRENT:
			version = "actuelle";
			break;
	}

	switch (ehdr->e_type)
	{
		case ET_NONE:
			type = "unknown type";
			break;
		case ET_REL:
			type = "relocatable file";
			break;
		case ET_EXEC:
			type = "executable file";
			break;
		case ET_DYN:
			type = "shared object";
			break;
		case ET_CORE:
			type = "core file";
			break;
	}

	switch (ehdr->e_ident[EI_OSABI])
	{
		case ELFOSABI_NONE:
			OS_name = "UNIX System V";
			break;
		/*case ELFOSABI_SYSV:
			OS_name = "UNIX System V";
			break;*/
		case ELFOSABI_HPUX:
			OS_name = "HP-UX";
			break;
		case ELFOSABI_NETBSD:
			OS_name = "NetBSD";
			break;
		case ELFOSABI_LINUX:
			OS_name = "Linux";
			break;
		case ELFOSABI_SOLARIS:
			OS_name = "Solaris";
			break;
		case ELFOSABI_IRIX:
			OS_name = "Irix";
			break;
		case ELFOSABI_FREEBSD:
			OS_name = "FreeBSD";
			break;
		case ELFOSABI_TRU64:
			OS_name = "UNIX TRU64";
			break;
		case ELFOSABI_ARM:
			OS_name = "ARM";
			break;
		case ELFOSABI_STANDALONE:
			OS_name = "Stand-alone (embedded)";
			break;

	}



	printf("e_ident: 0x%x %c %c %c\n", ehdr->e_ident[EI_MAG0],
			ehdr->e_ident[EI_MAG1],
			ehdr->e_ident[EI_MAG2],
			ehdr->e_ident[EI_MAG3]);
	printf("type: %s\n", type);
	printf("OS: %s\n", OS_name);
	printf("Architecture: %s\n", architecture);
	printf("Version: %s\n", version);
	printf("Data encoding: %s\n", data_encoding);
}
